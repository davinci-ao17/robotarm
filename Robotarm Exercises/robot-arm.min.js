var RobotArm=function(a){var b=this,c={},d=a.getContext("2d");b.columns=10,b.rows=8,b.speed=50,c.animationList=[],c.currentAnimation=0,c.arm={},c.arm.position=0,c.arm.horizontalOffset=0,c.arm.verticalOffset=0,c.arm.height=25,c.arm.hookHeight=10,c.floor={},c.floor.columnSeparatorHeight=10,c.floor.columnSeparatorPadding=5,c.blocks={},c.blocks.availableColors=["red","blue","green","white"],c.blocks.map=null,c.blocks.held=null,c.state={},c.state.arm={},c.state.arm.position=0,c.state.blocks={},c.state.blocks.map=null,c.state.blocks.held=null,c.settings={},c.settings.backgroundColor="#EEE",c.getAvailableTotalRowsHeight=function(){return d.canvas.height-c.arm.height-c.arm.hookHeight},c.copyMap=function(a){for(var b=[],c=0;c<a.length;c++)b.push(a[c].slice());return b};var e;c.render=function(){var a=(new Date).getTime(),b=a-(e||a);d.beginPath(),d.clearRect(0,0,d.canvas.width,d.canvas.height),d.fillStyle=c.settings.backgroundColor,d.fillRect(0,0,d.canvas.width,d.canvas.height),c.animationList.length>c.currentAnimation&&c.animationList[c.currentAnimation](0!=b?b:9999999)&&c.currentAnimation++,c.renderFloor(),c.renderArm(),c.renderBlocks(),d.stroke(),d.stroke(),e=a,requestAnimationFrame(c.render)},c.renderFloor=function(){d.save(),d.strokeStyle="#000",d.moveTo(0,d.canvas.height),d.lineTo(d.canvas.width,d.canvas.height);for(var a=d.canvas.width/b.columns,e=0;e<b.columns+1;e++)d.moveTo(e*a,d.canvas.height),d.lineTo(e*a,d.canvas.height-c.floor.columnSeparatorHeight);d.restore()},c.renderArm=function(){d.save(),d.strokeStyle="#000";var a=d.canvas.width/b.columns,e=c.arm.position*a,f=d.canvas.width/b.columns-2*c.floor.columnSeparatorPadding;if(d.moveTo(c.arm.horizontalOffset+e+a/2,0),d.lineTo(c.arm.horizontalOffset+e+a/2,c.arm.height+c.arm.verticalOffset),d.moveTo(c.arm.horizontalOffset+e+c.floor.columnSeparatorPadding,c.arm.height+c.arm.verticalOffset),d.lineTo(c.arm.horizontalOffset+e+a-c.floor.columnSeparatorPadding,c.arm.height+c.arm.verticalOffset),d.moveTo(c.arm.horizontalOffset+e+c.floor.columnSeparatorPadding,c.arm.height+c.arm.verticalOffset),d.lineTo(c.arm.horizontalOffset+e+c.floor.columnSeparatorPaddiqng,c.arm.height+c.arm.hookHeight+c.arm.verticalOffset),d.moveTo(c.arm.horizontalOffset+e+a-c.floor.columnSeparatorPadding,c.arm.height+c.arm.verticalOffset),d.lineTo(c.arm.horizontalOffset+e+a-c.floor.columnSeparatorPadding,c.arm.height+c.arm.hookHeight+c.arm.verticalOffset),null!=c.blocks.held){var g=c.getAvailableTotalRowsHeight()/b.rows;d.fillStyle=c.blocks.held,d.fillRect(c.arm.horizontalOffset+e+c.floor.columnSeparatorPadding+1,c.arm.height+c.arm.verticalOffset+1,f-3,g-2),d.strokeStyle="#000",d.rect(c.arm.horizontalOffset+e+c.floor.columnSeparatorPadding+1,c.arm.height+c.arm.verticalOffset+1,f-2,g-1)}d.restore()},c.renderBlocks=function(){d.save();for(var a=d.canvas.width/b.columns,e=c.getAvailableTotalRowsHeight()/b.rows,f=d.canvas.width/b.columns-2*c.floor.columnSeparatorPadding,g=0;g<c.blocks.map.length;g++){var h=c.blocks.map[g];if(h)for(var i=0;i<h.length;i++){var j=g*a;d.fillStyle=c.blocks.map[g][i],d.fillRect(j+c.floor.columnSeparatorPadding+1,d.canvas.height-e*(i+1)-1,f,e-1),d.strokeStyle="#000",d.rect(j+c.floor.columnSeparatorPadding,d.canvas.height-e*(i+1)-1,f,e)}}d.restore()},c.moveRightAnimation=function(a){return c.arm.horizontalOffset+=b.speed*d.canvas.width/1e3/a,!(c.arm.horizontalOffset<=d.canvas.width/b.columns)&&(c.arm.horizontalOffset=0,c.arm.position++,!0)},c.moveLeftAnimation=function(a){return c.arm.horizontalOffset-=b.speed*d.canvas.width/1e3/a,!(c.arm.horizontalOffset*-1<=d.canvas.width/b.columns)&&(c.arm.horizontalOffset=0,c.arm.position--,!0)},c.grabAnimation=function(a){if(!this.isMovingUp){if(c.moveArmDownAnimation(a)&&(this.isMovingUp=!0,c.blocks.map[c.arm.position]&&c.blocks.map[c.arm.position].length>0)){c.blocks.held=c.blocks.map[c.arm.position][c.blocks.map[c.arm.position].length-1];var b=c.blocks.map[c.arm.position],d=b.length;b.splice(d-1,1)}return!1}if(c.moveArmUpAnimation(a))return this.isMovingUp=!1,!0},c.dropAnimation=function(a){return this.isMovingUp?c.moveArmUpAnimation(a)?(this.isMovingUp=!1,!0):void 0:(c.moveArmDownAnimation(a)&&(this.isMovingUp=!0,null!=c.blocks.held&&(c.blocks.map[c.arm.position]||(c.blocks.map[c.arm.position]=[]),c.blocks.map[c.arm.position].push(c.blocks.held),c.blocks.held=null)),!1)},c.moveArmDownAnimation=function(a){c.arm.verticalOffset+=2*b.speed*d.canvas.height/1e3/a;var e=(void 0!=c.blocks.map[c.arm.position]?c.blocks.map[c.arm.position]:[]).length,f=c.getAvailableTotalRowsHeight()/b.rows;null!=c.blocks.held&&e++;var g=e*f,h=d.canvas.height-g-c.arm.height-3;return!(h>=c.arm.verticalOffset)},c.moveArmUpAnimation=function(a){return c.arm.verticalOffset-=2*b.speed*d.canvas.height/1e3/a,!(0<=c.arm.verticalOffset)&&(c.arm.verticalOffset=0,!0)},b.moveRight=function(){c.arm.position+1>b.columns||(c.animationList.push(c.moveRightAnimation),c.state.arm.position++)},b.moveLeft=function(){c.state.arm.position-1<0||(c.animationList.push(c.moveLeftAnimation),c.state.arm.position--)},b.scan=function(){return c.state.blocks.held||null},b.grab=function(){if(c.animationList.push(c.grabAnimation),c.state.blocks.map[c.state.arm.position]&&c.state.blocks.map[c.state.arm.position].length>0){c.state.blocks.held=c.state.blocks.map[c.state.arm.position][c.state.blocks.map[c.state.arm.position].length-1];var a=c.state.blocks.map[c.state.arm.position],b=a.length;a.splice(b-1,1)}},b.drop=function(){c.animationList.push(c.dropAnimation),null!=c.state.blocks.held&&(c.state.blocks.map[c.state.arm.position]||(c.state.blocks.map[c.state.arm.position]=[]),c.state.blocks.map[c.state.arm.position].push(c.state.blocks.held),c.state.blocks.held=null)},b.setMap=function(a){c.blocks.map=a.slice(),c.state.blocks.map=c.copyMap(a)},b.loadLevel=function(a){switch(a){case"exercise 1":b.setMap([[],["red"]]);break;case"exercise 2":b.setMap([["blue"],[],[],[],["blue"],[],[],["blue"]]);break;case"exercise 3":b.setMap([["white","white","white","white"]]);break;case"exercise 4":b.setMap([["blue","white","green"]]);break;case"exercise 5":b.setMap([[],["red","red","red","red","red","red","red"]]);break;case"exercise 6":b.setMap([["red"],["blue"],["white"],["green"],["green"],["blue"],["red"],["white"]]);break;case"exercise 7":b.setMap([[],["blue","blue","blue","blue","blue","blue"],[],["blue","blue","blue","blue","blue","blue"],[],["blue","blue","blue","blue","blue","blue"],[],["blue","blue","blue","blue","blue","blue"],[],["blue","blue","blue","blue","blue","blue"]]);break;case"exercise 8":b.loadLevel("exercise 5");break;case"exercise 9":b.setMap([["blue"],["green","green"],["white","white","white"],["red","red","red","red"]]);break;case"exercise 10":b.setMap([["green"],["blue"],["white"],["red"],["blue"]]);break;case"exercise 11":b.setMap([[],["white"],["red"],["red"],["blue"],["red"],["green"],["blue"],["green"],["green"]]);break;case"exercise 12":b.setMap([["green"],["red"],["green"],["white"],["green"],["blue"],["green"],["blue"],["green"]]);break;case"exercise 13":b.setMap([["green"],["green"],["green"],["blue"],["white"],["green"],["red"],["red"],["blue"],["green"]]);break;case"exercise 14":b.setMap([[],["green"],["white"],["green","white"],["red","white"],["white","white"],["blue"],["blue","blue","blue"],["blue","green","green"],["red"]]);break;case"exercise 15":b.setMap([[],["blue"],[],["blue"],["white"],[],["red"],["green"],["red"],["green"]]);break;default:throw new Error("There is no level with the name: "+a)}},b.randomLevel=function(a,d){a=a?a:b.columns,d=d?d:b.rows;for(var e=[],f=0;f<a;f++){e[f]=[];for(var g=Math.floor(Math.random()*d-1),h=0;h<g;h++)e[f][h]=c.blocks.availableColors[Math.floor(Math.random()*c.blocks.availableColors.length)]}b.setMap(e)},b.run=function(){requestAnimationFrame(c.render)}};